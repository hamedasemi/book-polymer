<link rel="import" href="/assets/libs/polymer/polymer.html">

<link rel="import" href="/app/shared/resource/x-resource.html">
<link rel="import" href="/app/shared/shared-layout/shared-layout.html">
<link rel="import" href="/app/shared/shared-content/shared-content.html">

<link rel="import" href="/app/core/text/text-element.html">
<link rel="import" href="/app/core/card-list/card-list-element.html">
<link rel="import" href="/app/core/card-item/card-item-element.html">
<link rel="import" href="/app/core/action-button/action-button-element.html">
<link rel="import" href="/app/core/x-icon/x-icon.html">

<dom-module id="origin-selection">

    <template>
        <style include="shared-layout"></style>
        <style include="shared-content"></style>
        <style>
            :host {
                @apply(--flex-column);
                -ms-flex-positive: 1;
                    flex-grow: 1;
            }

            content-component {
                @apply(--flex-column);
                -ms-flex-pack: center;
                    justify-content: center;
                -ms-flex-positive: 1;
                    flex-grow: 1;
            }

            text-container {
                @apply(--md-padding-sides);
            }

            highlight-content[discount] {
                background-color: #FF6600;
                color: #fff;
            }

            highlight-content text-element {
                color: #fff;
                letter-spacing: 1.1px;
            }

            text-element[h1],
            text-element[preamble] {
                opacity: 0;
                animation: fadeIn .6s forwards ease-in .1s;
                -webkit-backface-visibility: hidden;
                        backface-visibility: hidden;
            }

            @keyframes fadeIn {
                100% { opacity: 1; }
            }
        </style>

        <content-component>

            <text-container>
                <text-element h1="">[[campaign.attributes.originHeading]]</text-element>
                <text-element preamble="" html="[[campaign.attributes.originBody]]"></text-element>
            </text-container>

            <card-list-element>
                <template is="dom-repeat" items="[[originList]]" as="origin">
                    <card-item-element>
                        <highlight-content hidden$="[[!origin.preferred]]">
                            <text-element highlight="">[[localize(&apos;origin-selection.preferred.title&apos;)]]</text-element>
                        </highlight-content>
                        <highlight-content hidden$="[[!origin.discount]]" discount="">
                            <text-element highlight="">[[localize(&apos;origin-selection.discount.title&apos;)]]</text-element>
                        </highlight-content>
                        <area-content>
                            <x-icon card-icon="" name="icon-origin-[[origin.type]]"></x-icon>
                            <text-element h2="" align="center" margin-none="">[[localize(&apos;origin-selection.card.title&apos;, &apos;type&apos;, origin.type)]]</text-element>
                            <text-element align="center" margin-none="" hidden$="[[!origin.preferred]]">+[[origin.price]] [[origin.priceUnit]]</text-element>
                            <text-element align="center" margin-none="" line-through="" hidden$="[[!origin.discount]]">[[origin.price]] [[origin.priceUnit]]</text-element>
                        </area-content>
                        <action-content>
                            <action-button-element margin-none="" on-click="goForward" id="[[index]]" hidden$="[[!origin.preferred]]">[[localize(&apos;general.button.choose&apos;)]]</action-button-element>
                            <action-button-element margin-none="" on-click="goForward" id="[[index]]" hidden$="[[origin.preferred]]" secondary="">+[[calculatePrice(origin)]] [[origin.priceUnit]]</action-button-element>
                        </action-content>
                    </card-item-element>
                </template>
            </card-list-element>
        </content-component>

    </template>

    <script>"use strict";

Polymer({

    is: "origin-selection",

    behaviors: [Polymer.Behaviors.Resource],

    properties: {
        campaign: {
            type: Object
        },
        originList: {
            type: Array
        }
    },

    goForward: function goForward(event) {
        var normalizedEvent = Polymer.dom(event);
        var id = normalizedEvent.localTarget.id;
        var origin = this.originList[id];
        this.fire("on-origin", {
            origin: origin
        });
        this.fire("on-notify-event", { affirmation: this.localize("notification.origin-type", "type", origin.type) });
        this.fire("on-analytics-event", { category: "ursprung", action: "click", label: origin.type });
    },

    calculatePrice: function calculatePrice(origin) {
        if (typeof origin.discount !== "undefined") {
            return origin.price + origin.discount.price;
        } else {
            return origin.price;
        }
    }
});</script>

</dom-module>