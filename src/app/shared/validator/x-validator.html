<link rel="import" href="/assets/libs/polymer/polymer.html">

<dom-module id="x-validator">
    <script>
        Polymer({

            is: `x-validator`,

            isValidPostalCode: function(postalCode) {
                let pattern = new RegExp(`^[1-9][0-9]{4}$`);
                return pattern.test(postalCode);
            },

            isValidPostalCodePattern: function(postalCode) {
                let pattern = new RegExp(`^[1-9][0-9]{0,5}$`);
                return postalCode.length === 0 || pattern.test(postalCode);
            },

            isValidPersonalNumber: function(personalNumber) {
                let pattern = new RegExp(`^(?!(19|20))[0-9]{10}$|^[0-9]{6}-[0-9]{4}$|^(19|20)[0-9]{10}$|^(19|20)[0-9]{6}-[0-9]{4}$`);
                return pattern.test(personalNumber);
            },

            isValidPersonalNumberPattern: function(personalNumber) {
                let pattern = new RegExp(`^[0-9]{0,12}$|^[0-9]{0,6}-$|^[0-9]{0,6}-[0-9]{0,4}$|^[0-9]{0,8}-$|^[0-9]{0,8}-[0-9]{0,4}$`);
                return pattern.test(personalNumber);
            },

            isValidPersonalNumberChecksum: function(personalNumber) {
                let trimmedPersonalNumber = personalNumber.replace(/\s+/g, ``).replace(/-+/g, ``);
                if (trimmedPersonalNumber.length === 12) {trimmedPersonalNumber = trimmedPersonalNumber.substring(2);}
                const numbers = trimmedPersonalNumber.split(``);
                const checkDigit = parseInt(numbers.pop());
                const total = numbers.reduce(function (prev, current, index) {
                    const multiple = ((index % 2) === 0) ? 2 : 1;
                    const value = parseInt(current * multiple);
                    const sum = (value % 10) + Math.floor((value / 10));
                    return parseInt(prev) + sum;
                }, 0);
                const lastDigit = (total % 10);
                if (lastDigit === 0) { return checkDigit === lastDigit; }
                else { return checkDigit === (10 - lastDigit); }
            },

            isValidEmailAddress: function(emailaddress) {
                let pattern = new RegExp(`^[_A-Za-z0-9-\\+]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})$`);
                return pattern.test(emailaddress);
            },

            isValidSwedishTelephoneNumber: function(telephoneNumber) {
                let trimmedTelephoneNumber = telephoneNumber.replace(/\s+/g, ``)
                let pattern = new RegExp(`^08-[0-9]{6,8}$|^0[1-9][0-9]-[0-9]{5,7}$|^0[1-9][0-9]{2}-[0-9]{5,6}$|^0[1-9][0-9]{6,8}$|^\\+[1-9][0-9]{6,}$`);
                return pattern.test(trimmedTelephoneNumber);
            },

            isValidSwedishTelephoneNumberPattern: function(telephoneNumber) {
                let trimmedTelephoneNumber = telephoneNumber.replace(/\s+/g, ``)
                let pattern = new RegExp(`^(0|\\+)[0-9]{0,1}[0-9\\-]{0,1}[0-9\\-]{0,1}[0-9\\-]{0,1}[0-9]{0,}$`);
                return pattern.test(trimmedTelephoneNumber);
            },

            isValidGridCode: function(gridCode) {
                let pattern = new RegExp(`^[a-zA-Z]{3}$`);
                return pattern.test(gridCode);
            },

            isValidGridCodePattern: function(gridCode) {
                let pattern = new RegExp(`^[a-zA-Z]{0,3}$`);
                return pattern.test(gridCode);
            },

            isValidMeterPoint: function(meterPoint) {
                let pattern = new RegExp(`^735999[0-9]{12}$`);
                return pattern.test(meterPoint);
            },

            isValidMeterPointPattern: function(meterPoint) {
                let pattern = new RegExp(`^$|^7$|^73$|^735$|^7359$|^73599$|^735999$|^735999[0-9]{0,12}$`);
                return pattern.test(meterPoint);
            },

            isValidMeterPointChecksum: function(meterPoint) {
                meterPoint = meterPoint.trim();
                const numbers = meterPoint.split(``);
                const checkDigit = parseInt(numbers.pop());
                const total = numbers.reduce(function (prev, current, index) {
                    const multiple = ((index % 2) === 0) ? 3 : 1;
                    return parseInt(prev) + (parseInt(current * multiple));
                }, 0);
                const lastDigit = (total % 10);
                if (lastDigit === 0) { return checkDigit === lastDigit; }
                else { return checkDigit === (10 - lastDigit); }
            },

            isValidApartmentNumber: function(apartmentNumber) {
                let pattern = new RegExp(`^[0-9]{4}$`);
                return pattern.test(apartmentNumber);
            },

            isValidApartmentNumberPattern: function(apartmentNumber) {
                let pattern = new RegExp(`^[0-9]{0,4}$`);
                return pattern.test(apartmentNumber);
            },

            isValidOrganisationNumber: function(organisationNumber) {
                let pattern = new RegExp(`^[0-9]{6,8}-?[0-9]{4}$`);
                return pattern.test(organisationNumber);
            },

            isValidOrganisationNumberPattern: function(organisationNumber) {
                let pattern = new RegExp(`^[0-9]{0,6}-?[0-9]{0,4}$|^[0-9]{0,8}-?[0-9]{0,4}$`);
                return pattern.test(organisationNumber);
            }

        });
    </script>
</dom-module>